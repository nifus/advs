<div class="panel panel-default">
    <div class="panel-body">
        <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <input type="text" class="form-control" ng-model="filter.key" placeholder="Name, Address or Phone">
                </div>
                <div class="form-group">
                    <label class="sr-only">Category</label>
                    <select ng-model="filter.category_id" class="form-control"
                            ng-options="cat.id as cat.title for  cat in env.categories">
                        <option value="">Any</option>
                    </select>
                </div>

                <div class="form-group">
                    <button class="btn btn-default" type="button" ng-click="filter={}">Reset</button>
                </div>

            </form>
        </div>
        <div class="col-md-6">
            <div class="form-group text-right">
                <upload ng-model="env.file" hide-result="true" number-of-files="1" ng-change="fileSelected">
                    <button ng-disabled="env.submit" class="btn btn-primary" type="button" ng-click="filter={}"><span
                            class="glyphicon glyphicon-upload" aria-hidden="true"></span>
                        Upload
                    </button>
                </upload>
                <button class="btn btn-success" type="button" ng-click="env.create=true"><span
                        class="glyphicon glyphicon-plus" aria-hidden="true"></span>Add
                </button>
            </div>
        </div>


    </div>
</div>
<form name="pointForm">
    <table class="table">
        <tr>
            <th  style="width: 10%">Category</th>
            <th  style="width: 10%">Name</th>
            <th  style="width: 30%">Address</th>
            <th  style="width: 10%">Phone</th>
            <th  style="width: 10%">URL</th>
            <th style="width: 20%"></th>
        </tr>
        <tr ng-if="env.create==true">
            <td><select ng-model="model.category_id"
                        ng-options="category.id as category.title for category in env.categories" class="form-control"
                        required></select></td>
            <td><input type="text" class="form-control" ng-model="model.name" required></td>
            <td><input type="text" class="form-control" ng-model="model.address" required></td>
            <td><input type="text" class="form-control" ng-model="model.phone"></td>
            <td><input type="text" class="form-control" ng-model="model.url"></td>
            <td>
                <div class="btn-group">
                    <button type="button" class="btn btn-default" ng-click="create(model)"
                            ng-disabled="pointForm.$invalid">Save
                    </button>
                    <button type="button" class="btn btn-danger" ng-click="env.create=false">Cancel</button>
                </div>
            </td>
        </tr>
        <tr ng-repeat="point in env.display_points">
            <td>
                <span ng-if="point.id!=env.edit.id">{{point.category.title}}</span>

                <select  ng-if="point.id==env.edit.id" ng-model="env.edit.category_id"
                        ng-options="category.id as category.title for category in env.categories"
                        class="form-control" required></select>
            </td>

            <td>
                <span ng-if="point.id!=env.edit.id">{{point.name}}</span>
                <input ng-if="point.id==env.edit.id" type="text" class="form-control" ng-model="env.edit.name" required>
            </td>

            <td>
                <span ng-if="point.id!=env.edit.id">{{point.address}}</span>
                <input  ng-if="point.id==env.edit.id" type="text" class="form-control" ng-model="env.edit.address" required>
            </td>

            <td>
                <span ng-if="point.id!=env.edit.id">{{point.phone}}</span>
                <input ng-if="point.id==env.edit.id" type="text" class="form-control" ng-model="env.edit.phone" required>
            </td>
            <td>
                <span ng-if="point.id!=env.edit.id">{{point.url}}</span>
                <input ng-if="point.id==env.edit.id" type="text" class="form-control" ng-model="env.edit.url" required>
            </td>

            <td>
                <div class="btn-group" ng-if="point.id!=env.edit.id">
                    <button type="button" class="btn btn-default" ng-click="env.edit=point">Edit</button>
                    <button type="button" class="btn btn-danger" ng-click="delete(point, $index)">Delete</button>
                </div>
                <div class="btn-group" ng-if="point.id==env.edit.id">
                    <button type="button" class="btn btn-default" ng-click="update(point)" ng-click="edit(env.edit)" ng-disabled="pointForm.$invalid">Save</button>
                    <button type="button" class="btn btn-danger" ng-click="env.edit=null">Cancel</button>
                </div>
            </td>
        </tr>

    </table>
</form>

<nav aria-label="Page navigation">
    <ul class="pagination">

        <li ng-repeat="n in range(1,env.pages)"
            ng-class="{'active':env.page==n}">
            <a class="link" ng-click="setPage(n)">{{n}}</a>
        </li>


    </ul>
</nav>

